<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Documentation by YARD 0.6.4</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html" title="Index">Index</a> &raquo; 
    <span class="title">File: README</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><div id='filecontents'><h1><a href="http://1on1.com/">1on1</a> one-pivot GEM</h1>

<h2>Overview</h2>

<p>The <strong>one-pivot</strong> GEM provides a simple way to mine data from a list of objects. There are no constraints on the types of objects that you can pivot. You can pivot anything from a list of numbers to a list of ActiveRecord objects to anything in between.</p>

<p><strong><code>One::Pivoter</code></strong> exposes two methods of importance.</p>

<ul>
<li><strong><code>pivot</code></strong> - runs a single pivot</li>
<li><strong><code>multi-pivot</code></strong> - stacks multiple pivots into a single result</li>
</ul>


<p>A <strong><code>pivot</code></strong> is simply a Ruby block (or Proc) that executes for each item in the list.  The result returned from this block then serves as the key in the resulting Hash.</p>

<p>Lets have a look at some examples.</p>

<p><em>Note: there are a few advanced features not demonstrated in the examples below. For example, adding identifiers to pivots or attaching observers to pivot operations. We use these features at 1on1 to cache pivot results for each item. This gives us a big performance boost when the same item participates in multiple pivots during its lifetime... especially when the pivot Proc is an expensive operation.  Have a look at the <a href="https://github.com/one-on-one/pivot/tree/master/test">tests</a> when you want to dig a little deeper.</em></p>

<h2>A simple single pivot</h2>

<pre class="code">
<span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>one-pivot</span><span class='tstring_end'>'</span></span>

<span class='comment'># create the pivot instance
</span><span class='id pivoter'>pivoter</span> <span class='op'>=</span> <span class='const'>One</span><span class='op'>::</span><span class='const'>Pivoter</span><span class='period'>.</span><span class='id new'>new</span>

<span class='comment'># create a list of objects to pivot
</span><span class='id list'>list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>4</span><span class='comma'>,</span><span class='int'>5</span><span class='comma'>,</span><span class='int'>6</span><span class='comma'>,</span><span class='int'>7</span><span class='comma'>,</span><span class='int'>8</span><span class='comma'>,</span><span class='int'>9</span><span class='rbracket'>]</span>

<span class='comment'># run a single pivot
</span><span class='comment'># note: the block passed to the pivot method is invoked for each item in the list
</span><span class='comment'># note: the result from the block will act as the 'key' in the resulting Hash
</span><span class='id result'>result</span> <span class='op'>=</span> <span class='id pivoter'>pivoter</span><span class='period'>.</span><span class='id pivot'>pivot</span><span class='lparen'>(</span><span class='id list'>list</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id item'>item</span><span class='op'>|</span> <span class='id item'>item</span> <span class='op'>&lt;=</span> <span class='int'>5</span><span class='rbrace'>}</span>

<span class='comment'># 'result' will be a Hash with the following structure
</span><span class='lbrace'>{</span>
  <span class='kw'>true</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>4</span><span class='comma'>,</span><span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='kw'>false</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>6</span><span class='comma'>,</span><span class='int'>7</span><span class='comma'>,</span><span class='int'>8</span><span class='comma'>,</span><span class='int'>9</span><span class='rbracket'>]</span>
<span class='rbrace'>}</span>
</pre>


<h2>A simple multi-pivot</h2>

<pre class="code">
<span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>one-pivot</span><span class='tstring_end'>'</span></span>

<span class='comment'># create the pivot instance
</span><span class='comment'># note: the multi-pivot delimiter that was specified
</span><span class='id pivoter'>pivoter</span> <span class='op'>=</span> <span class='const'>One</span><span class='op'>::</span><span class='const'>Pivoter</span><span class='period'>.</span><span class='id new'>new</span>

<span class='comment'># create a list of objects to pivot
</span><span class='id list'>list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>4</span><span class='comma'>,</span><span class='int'>5</span><span class='comma'>,</span><span class='int'>6</span><span class='comma'>,</span><span class='int'>7</span><span class='comma'>,</span><span class='int'>8</span><span class='comma'>,</span><span class='int'>9</span><span class='rbracket'>]</span>

<span class='comment'># run several pivots together
</span><span class='id pivots'>pivots</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

<span class='id pivots'>pivots</span> <span class='op'>&lt;&lt;</span> <span class='id lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id i'>i</span><span class='op'>|</span>
  <span class='id key'>key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less than or equal to 5</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id i'>i</span> <span class='op'>&lt;=</span> <span class='int'>5</span>
  <span class='id key'>key</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greater than 5</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id pivots'>pivots</span> <span class='op'>&lt;&lt;</span> <span class='id lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id i'>i</span><span class='op'>|</span>
  <span class='id key'>key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greater than or equal to 3</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id i'>i</span> <span class='op'>&gt;=</span> <span class='int'>3</span>
  <span class='id key'>key</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less than 3</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id pivots'>pivots</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span><span class='symbol'>:delimiter</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> &amp; </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>

<span class='id result'>result</span> <span class='op'>=</span> <span class='id pivoter'>pivoter</span><span class='period'>.</span><span class='id multi_pivot'>multi_pivot</span><span class='lparen'>(</span><span class='id list'>list</span><span class='comma'>,</span> <span class='op'>*</span><span class='id pivots'>pivots</span><span class='rparen'>)</span>

<span class='comment'># 'result' will be a Hash with the following structure
</span><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less than or equal to 5 &amp; greater than or equal to 3</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span> 
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less than or equal to 5 &amp; less than 3</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> 
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greater than 5 &amp; greater than or equal to 3</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>6</span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>9</span><span class='rbracket'>]</span>
<span class='rbrace'>}</span>
</pre>


<h2>A real world example</h2>

<pre class="code">
<span class='comment'># we'll be working with ActiveRecord objects based on the following schema
</span><span class='comment'># ============================================================================
</span><span class='comment'># create_table &quot;users&quot;, :force =&gt; true do |t|
</span><span class='comment'>#   t.string   &quot;name&quot;
</span><span class='comment'>#   t.datetime &quot;created_at&quot;
</span><span class='comment'>#   t.datetime &quot;updated_at&quot;
</span><span class='comment'># end
</span><span class='comment'>#
</span><span class='comment'># create_table &quot;skills&quot;, :force =&gt; true do |t|
</span><span class='comment'>#   t.string   &quot;name&quot;
</span><span class='comment'>#   t.datetime &quot;created_at&quot;
</span><span class='comment'>#   t.datetime &quot;updated_at&quot;
</span><span class='comment'># end
</span><span class='comment'>#
</span><span class='comment'># create_table &quot;skills_users&quot;, :id =&gt; false, :force =&gt; true do |t|
</span><span class='comment'>#   t.integer &quot;user_id&quot;
</span><span class='comment'>#   t.integer &quot;skill_id&quot;
</span><span class='comment'># end
</span><span class='comment'># 
</span><span class='comment'># and will seed the datbase with the following data
</span><span class='comment'># ============================================================================
</span><span class='comment'># ruby = Skill.create(:name =&gt; &quot;Ruby&quot;)
</span><span class='comment'># python = Skill.create(:name =&gt; &quot;Python&quot;)
</span><span class='comment'># php = Skill.create(:name =&gt; &quot;PHP&quot;)
</span><span class='comment'># javascript = Skill.create(:name =&gt; &quot;JavaScript&quot;)
</span><span class='comment'># 
</span><span class='comment'># users = User.create([
</span><span class='comment'>#   {:name =&gt; &quot;Ryan&quot;, :skills =&gt; [ruby]},
</span><span class='comment'>#   {:name =&gt; &quot;Dave&quot;, :skills =&gt; [php, javascript]},
</span><span class='comment'>#   {:name =&gt; &quot;Brett&quot;, :skills =&gt; [ruby, javascript]},
</span><span class='comment'>#   {:name =&gt; &quot;Jay&quot;, :skills =&gt; [ruby, python, php, javascript]},
</span><span class='comment'>#   {:name =&gt; &quot;Doug&quot;}
</span><span class='comment'># ])
</span><span class='comment'>#
</span>
<span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>one-pivot</span><span class='tstring_end'>'</span></span>

<span class='id pivoter'>pivoter</span> <span class='op'>=</span> <span class='const'>One</span><span class='op'>::</span><span class='const'>Pivoter</span><span class='period'>.</span><span class='id new'>new</span>
<span class='comment'># note that the pivot block returns an array
</span><span class='comment'># each unique value in the arrays returned will become a key in the resulting Hash
</span><span class='id result'>result</span> <span class='op'>=</span> <span class='id pivoter'>pivoter</span><span class='period'>.</span><span class='id pivot'>pivot</span><span class='lparen'>(</span><span class='const'>User</span><span class='period'>.</span><span class='id all'>all</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id user'>user</span><span class='op'>|</span>
  <span class='id user'>user</span><span class='period'>.</span><span class='id skills'>skills</span>
<span class='kw'>end</span>

<span class='comment'># 'result' will be Hash with the following structure
</span><span class='comment'># note: I've simplified the object structure (using names only) for clarity 
</span><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Brett</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jay</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ryan</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PHP</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dave</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jay</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JavaScript</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Brett</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dave</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jay</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Python</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jay</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='kw'>nil</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Doug</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='rbrace'>}</span> 
</pre>
</div></div>
    
    <div id="footer">
  Generated on Wed Feb 23 14:41:20 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.9.2).
</div>

  </body>
</html>